<!doctype html>
<html lang="zh-Hans" dir="ltr" class="docs-wrapper docs-doc-page docs-version-current plugin-docs plugin-id-default docs-doc-id-bigdata/hbase学习">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v2.3.0">
<title data-rh="true">hbase学习 | Docs</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="https://www.ylsite.tk/docs/bigdata/hbase学习"><meta data-rh="true" name="docusaurus_locale" content="zh-Hans"><meta data-rh="true" name="docsearch:language" content="zh-Hans"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="hbase学习 | Docs"><meta data-rh="true" name="description" content="内容和结构主要来自Carol McDonald 的文章，对照官方文档梳理学习了一遍，记录备忘。"><meta data-rh="true" property="og:description" content="内容和结构主要来自Carol McDonald 的文章，对照官方文档梳理学习了一遍，记录备忘。"><link data-rh="true" rel="icon" href="/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://www.ylsite.tk/docs/bigdata/hbase学习"><link data-rh="true" rel="alternate" href="https://www.ylsite.tk/docs/bigdata/hbase学习" hreflang="zh-Hans"><link data-rh="true" rel="alternate" href="https://www.ylsite.tk/docs/bigdata/hbase学习" hreflang="x-default"><link rel="alternate" type="application/rss+xml" href="/blog/rss.xml" title="Docs RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/blog/atom.xml" title="Docs Atom Feed"><link rel="stylesheet" href="/assets/css/styles.6f328ed7.css">
<link rel="preload" href="/assets/js/runtime~main.d0f6cce0.js" as="script">
<link rel="preload" href="/assets/js/main.d0f70bc6.js" as="script">
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div role="region" aria-label="跳到主要内容"><a class="skipToContent_fXgn" href="#docusaurus_skipToContent_fallback">跳到主要内容</a></div><nav aria-label="Main" class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="切换导航栏" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/img/logo.png" alt="yolo-docs Logo" class="themedImage_ToTc themedImage--light_HNdA"><img src="/img/logo.png" alt="yolo-docs Logo" class="themedImage_ToTc themedImage--dark_i4oU"></div><b class="navbar__title text--truncate">yolo-docs</b></a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/docs/About">文档</a><a class="navbar__item navbar__link" href="/blog">博客</a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/yoloz/yolo-docs" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link header-github-link" aria-label="GitHub repository"></a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="切换浅色/暗黑模式（当前为浅色模式）" aria-label="切换浅色/暗黑模式（当前为浅色模式）" aria-live="polite"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="searchBox_ZlJk"><div class="navbar__search searchBarContainer_NW3z"><input placeholder="搜索" aria-label="Search" class="navbar__search-input"><div class="loadingRing_RJI3 searchBarLoadingRing_YnHq"><div></div><div></div><div></div><div></div></div><div class="searchHintContainer_Pkmr"><kbd class="searchHint_iIMx">ctrl</kbd><kbd class="searchHint_iIMx">K</kbd></div></div></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0 docsWrapper_BCFX"><button aria-label="回到顶部" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docPage__5DB"><aside class="theme-doc-sidebar-container docSidebarContainer_b6E3"><div class="sidebarViewport_Xe31"><div class="sidebar_njMd"><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/About">About</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret menu__link--active" aria-expanded="true" href="/docs/bigdata/CDH安装">bigdata</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/bigdata/CDH安装">CDH安装</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/bigdata/elasticsearch">elasticsearch</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/bigdata/filebeat使用">filebeat使用</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/bigdata/hadoop安装">hadoop安装</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/docs/bigdata/hbase学习">hbase学习</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/bigdata/hbase安装">hbase安装</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/bigdata/hive安装">hive安装</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/bigdata/hive的JDBC">hive的JDBC</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/bigdata/kafka优化配置">kafka优化配置</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/bigdata/kafka安全配置">kafka安全配置</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/bigdata/kafka消费者源码">kafka消费者源码</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/bigdata/memcache学习">memcache学习</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/bigdata/zookeeper学习">zookeeper学习</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/docs/concept/RESTful学习">concept</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/docs/concurrent/JAVA管程模型">concurrent</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/docs/database/Mysql导入导出">database</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/docs/devOps/su与sudo">devOps</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/docs/java/threadDump分析">java</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/docs/linux/AIpine系统">linux</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/docs/network/linux内核接收网络包">network</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/docs/script/bash和bat">script</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/docs/tools/idea快捷键">tools</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/docs/vue/大文件上传">vue</a></div></li></ul></nav></div></div></aside><main class="docMainContainer_gTbr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="页面路径"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="主页面" class="breadcrumbs__link" href="/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_YNFT"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li class="breadcrumbs__item"><span class="breadcrumbs__link">bigdata</span><meta itemprop="position" content="1"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">hbase学习</span><meta itemprop="position" content="2"></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">本页总览</button></div><div class="theme-doc-markdown markdown"><header><h1>hbase学习</h1></header><p><em>内容和结构主要来自<a href="https://mapr.com/blog/in-depth-look-hbase-architecture/" target="_blank" rel="noopener noreferrer">Carol McDonald 的文章</a>，对照官方文档梳理学习了一遍，记录备忘。</em></p><p><img loading="lazy" alt="hbasearch1.jpg" src="/assets/images/hbasearch1-1e74c5892fd4c9868c12480db3ee8c36.jpg" width="603" height="389" class="img_ev3q"></p><p>它们的主要功能有：</p><p><strong>Hmaster:</strong></p><ul><li>管理 HregionServer，实现负载均衡；</li><li>管理和分配 Hregion, 如 Hregion split 时分配新的 Hregion, HregionServer 退出时迁移其下的 Hregion 到其他 HregionServer 上；</li><li>DDL 操作(table, columnfamily 的增删改等)；</li><li>管理 namespace 和 table 的元数据(存储在 hdfs 上)；</li><li>权限控制(ACL)；</li></ul><p><strong>HregionServer:</strong></p><ul><li>存放和管理本地的 Hregion;</li><li>读写 hdfs，管理 table 中的数据；</li><li>client 通过 HregionServer 读写数据；</li></ul><p><strong>zookeeper:</strong></p><ul><li>存放 Hbase 集群的元数据及集群的状态信息；</li><li>Hmaster 主从节点的 active;</li></ul><p>HRegion 所处理的数据尽量和数据所在的 DataNode 在一起，实现数据的本地化。数据本地化并不是总能实现，如在 HRegion 移动(Split)时，需要等下一次 Compact 才能继续回到本地化。Hmaster 和 namenode 都支持多个热备份，使用 zookeeper 来做协调。Hregionserver 和 datanode 一般会放在相同的 server 上实现数据的本地化。如下：</p><p><img loading="lazy" alt="hbasearch2.png" src="/assets/images/hbasearch2-13163402febac7942b4f6da64ba0247b.png" width="632" height="343" class="img_ev3q"></p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="regions">Regions<a href="#regions" class="hash-link" aria-label="Regions的直接链接" title="Regions的直接链接">​</a></h2><p>Hbase 使用 rowkey 将表水平分割成多个 hregion, region 分配给相应的 regionserver 管理. 如下：</p><p><img loading="lazy" alt="hbasearch3.png" src="/assets/images/hbasearch3-7f724f8e977a9771043d42448fbe98d1.png" width="724" height="337" class="img_ev3q"></p><p><img loading="lazy" alt="hbasearch4.png" src="data:image/png;base64,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" width="958" height="187" class="img_ev3q"></p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="region">Region<a href="#region" class="hash-link" aria-label="Region的直接链接" title="Region的直接链接">​</a></h3><ul><li>A table can be divided horizontally into one or more regions. A region contains a contiguous, sorted range of rows between a start key and an end key;</li><li>Each region is 1GB in size (default)；</li><li>A region of a table is served to the client by a RegionServer；</li><li>A region server can serve about 1, 000 regions (which may belong to the same table or different tables)；</li></ul><p><img loading="lazy" alt="hbasearch5.png" src="/assets/images/hbasearch5-a0e89d0ead398f25938499922f9e78c4.png" width="494" height="258" class="img_ev3q"></p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="region-split">Region Split<a href="#region-split" class="hash-link" aria-label="Region Split的直接链接" title="Region Split的直接链接">​</a></h3><p>最初一个表一个 region，随着数据增多，region 分裂成两个，两个新的 region 会在同一个 HRegionServer 中创建，它们各自包含父 region 一半的数据，split 完成后，父 region 下线，而新的两个子 region 向 HMaster 注册上线。</p><p><img loading="lazy" alt="hbasearch6.png" src="/assets/images/hbasearch6-f6fa7cd56b938f55942297f01446597f.png" width="583" height="314" class="img_ev3q"></p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="read-load-balancing">Read Load Balancing<a href="#read-load-balancing" class="hash-link" aria-label="Read Load Balancing的直接链接" title="Read Load Balancing的直接链接">​</a></h3><p>分割起初发生在一个 regionserver 上，由于负载均衡，master 会将新生成的 region 分配到其他的 regionserver 上，这样会有可能一些 regionserver 处理的数据暂时在远程机器上，在 major compact 的时候会将远程数据文件移动到本地来。</p><p><img loading="lazy" alt="hbasearch7.png" src="/assets/images/hbasearch7-0114057f8278f14e607c593a841c75f6.png" width="492" height="259" class="img_ev3q"></p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="hbase-hmaster">HBase Hmaster<a href="#hbase-hmaster" class="hash-link" aria-label="HBase Hmaster的直接链接" title="HBase Hmaster的直接链接">​</a></h2><p>HMaster 没有单点故障问题，可以启动多个 HMaster，通过 ZooKeeper 的 Master Election 机制保证同时只有一个 HMaster 出于 Active 状态，其他的 HMaster 则处于热备份状态。主要职责有：</p><ul><li>协调 HRegionServer</li><li><ul><li>启动时 region 的分配，以及负载均衡和修复时 region 的重新分配;</li></ul></li><li><ul><li>监控集群中所有 regionServer 的状态(通过 Heartbeat 和监听 ZooKeeper 中的状态)。</li></ul></li><li>Admin 职能，创建、删除、修改 Table 的定义。如下：</li></ul><p><img loading="lazy" alt="hbasearch8.png" src="/assets/images/hbasearch8-e6e2e7f91d10192fd7f851c23c5c34dd.png" width="579" height="302" class="img_ev3q"></p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="zookeeper-the-coordinator">ZooKeeper: The Coordinator<a href="#zookeeper-the-coordinator" class="hash-link" aria-label="ZooKeeper: The Coordinator的直接链接" title="ZooKeeper: The Coordinator的直接链接">​</a></h3><p>Hbase 使用 zookeeper 来协调集群的管理。如下：</p><p><img loading="lazy" alt="hbasearch9.png" src="/assets/images/hbasearch9-dc05f1a61430a1624a109b552e4e4306.png" width="647" height="279" class="img_ev3q"></p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="how-the-components-work-together">How the Components Work Together<a href="#how-the-components-work-together" class="hash-link" aria-label="How the Components Work Together的直接链接" title="How the Components Work Together的直接链接">​</a></h3><p>zooKeeper 协调集群所有节点的共享信息，在 master 和 regionserver 连接到 zooKeeper 后创建 Ephemeral 节点，使用心跳机制维持这个节点的存活状态，如果某个 Ephemeral 节点实效，则 HMaster 会收到通知，并做相应的处理。如下：</p><p><img loading="lazy" alt="hbasearch10.png" src="/assets/images/hbasearch10-ee9e66fa45eaac09dbd1710a781e0a5d.png" width="597" height="279" class="img_ev3q"></p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="hbase-first-read-or-write">HBase First Read or Write<a href="#hbase-first-read-or-write" class="hash-link" aria-label="HBase First Read or Write的直接链接" title="HBase First Read or Write的直接链接">​</a></h3><p>Hbase 中有一个特殊的目录表 META 表，存储了集群的所有 regions 位置，zookeeper 存储了这个 meta 表的位置。大概流程如下：<br>
<!-- -->1, 从 zooKeeper 中获取存储 meta 表的 regionserver 的位置；<br>
<!-- -->2, 从 meta 中查询用户 table 对应请求的 rowkey 所在的 regionserver 位置；<br>
<!-- -->3, 从查询到 regionServer 中获取数据；</p><p><img loading="lazy" alt="hbasearch11.png" src="/assets/images/hbasearch11-904d58d62a7df57edd2bb0c889733797.png" width="578" height="335" class="img_ev3q"></p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="hbase-meta-table">HBase Meta Table<a href="#hbase-meta-table" class="hash-link" aria-label="HBase Meta Table的直接链接" title="HBase Meta Table的直接链接">​</a></h3><p>hbase:meta 表存储了所有 region 的位置信息(The -ROOT- table was removed in HBase 0.96.0)，结构如下：</p><p><img loading="lazy" alt="hbasearch12.png" src="/assets/images/hbasearch12-b89e438238a5ffee7d3302fdd172c774.png" width="521" height="263" class="img_ev3q"></p><p><img loading="lazy" alt="hbasearch13.png" src="/assets/images/hbasearch13-d73298c4b24341d1510ae60737f24cc7.png" width="954" height="352" class="img_ev3q"></p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="region-server-components">Region Server Components<a href="#region-server-components" class="hash-link" aria-label="Region Server Components的直接链接" title="Region Server Components的直接链接">​</a></h3><p>regionserver 一般和 hdfs 的 datanode 在同一台机器上运行，实现数据的本地性，包含多个 region，由 WAL、BlockCache、MemStore、HFile 组成。如下：</p><p><img loading="lazy" alt="hbasearch14.png" src="/assets/images/hbasearch14-926f89cc368f9d69c583cadd8e569ddd.png" width="565" height="287" class="img_ev3q"></p><ul><li>WAL: Write Ahead Log is a file on the distributed file system. The WAL is used to store new data that hasn&#x27;t yet been persisted to permanent storage; it is used for recovery in the case of failure.</li><li>BlockCache: is the read cache. It stores frequently read data in memory. Least Recently Used data is evicted when full.</li><li>MemStore: is the write cache. It stores new data which has not yet been written to disk. It is sorted before writing to disk. There is one MemStore per column family per region.</li><li>Hfiles store the rows as sorted KeyValues on disk.</li></ul><h3 class="anchor anchorWithStickyNavbar_LWe7" id="hbase-write">HBase Write<a href="#hbase-write" class="hash-link" aria-label="HBase Write的直接链接" title="HBase Write的直接链接">​</a></h3><p>当客户端发起一个 Put 请求时，首先它从 hbase:meta 表中查出该 Put 数据最终需要去的 regionserver。然后客户端将 Put 请求发送给相应的 regionserver，在 regionserver 中它首先会将该 Put 操作写入 WAL 日志文件中(Flush 到磁盘中)。</p><p><img loading="lazy" alt="hbasearch15.png" src="/assets/images/hbasearch15-4e667d0b445bf4ddf77da3d011b44b82.png" width="494" height="234" class="img_ev3q"></p><p>写完 WAL 日志文件后，regionserver 根据 Put 中的 tablename 和 rowkey 找到对应的 region，并根据 column family 找到对应的 store，并将 Put 写入到该 store 的 memstore 中。此时写成功，并返回通知客户端。</p><p><img loading="lazy" alt="hbasearch16.png" src="/assets/images/hbasearch16-5a7be94cb30bff765abb6f38cf9d25f2.png" width="516" height="202" class="img_ev3q"></p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="hbase-memstore">HBase MemStore<a href="#hbase-memstore" class="hash-link" aria-label="HBase MemStore的直接链接" title="HBase MemStore的直接链接">​</a></h3><p>MemStore 是一个 In Memory Sorted Buffer，在每个 store 中都有一个 memstore，store 对应 region 中的 columnfamily。如下：</p><p><img loading="lazy" alt="hbasearch17.png" src="/assets/images/hbasearch17-b4ab589f690f84c61274cb60ff4ecb87.png" width="507" height="243" class="img_ev3q"></p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="hbase-region-flush">HBase Region Flush<a href="#hbase-region-flush" class="hash-link" aria-label="HBase Region Flush的直接链接" title="HBase Region Flush的直接链接">​</a></h3><p>当 memstore 积累满数据后，其中的内容(排序集合)flush 进 storeFile(hfile)中。注意的是 memstore 的最小 flush 单元是 region 而不是单个 memstore(即一个 flush，其中所有的都 flush)。可能这也是 hbase 中的 columnfamily 不能无限制的增加的原因(region 中很多 columnfamily 同时 flush)。在 flush 过程中，还会在尾部追加一些数据，其中就包括 flush 时最大的 WAL sequence 值，告诉 hbase 这个 hfile 写入的最新数据的序列，在 recover 时就知道从哪里开始，在 HRegion 启动时，这个 sequence 会被读取，并取最大的作为下一次更新时的起始 sequence。</p><p><img loading="lazy" alt="hbasearch18.png" src="/assets/images/hbasearch18-3a3f640d3dedb5f3711760f6e4c49864.png" width="487" height="205" class="img_ev3q"></p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="hbase-hfile">HBase HFile<a href="#hbase-hfile" class="hash-link" aria-label="HBase HFile的直接链接" title="HBase HFile的直接链接">​</a></h3><p>数据以 key/value(cell)的形式顺序的存储在 storefile 中，在 memstore 积累到足够的数据后 flush 到磁盘生成 hfile(memstore 中存储的 cell 遵循相同的排列顺序，所以是顺序写，性能很高，不需要不停的移动磁盘指针)。</p><p><img loading="lazy" alt="hbasearch19.png" src="/assets/images/hbasearch19-27642037350f70ee5e7e20b1f5c3db74.png" width="515" height="235" class="img_ev3q"></p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="hbase-hfile-structure">HBase HFile Structure<a href="#hbase-hfile-structure" class="hash-link" aria-label="HBase HFile Structure的直接链接" title="HBase HFile Structure的直接链接">​</a></h3><p>Hfile 的格式经历三次更改，现在是 v3, 详情官方文档(Appendix H: HFile format)。</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="hbase-read-merge">HBase Read Merge<a href="#hbase-read-merge" class="hash-link" aria-label="HBase Read Merge的直接链接" title="HBase Read Merge的直接链接">​</a></h3><p>如前文所述，每个 memstore 含有多个 hfile, 读取时扫描过多文件会影响性能。扫瞄的顺序依次是：BlockCache、MemStore、StoreFile(HFile)。其中 StoreFile 的扫瞄先会使用 Bloom Filter 过滤那些不可能符合条件的 HFile，然后使用 Block Index 快速定位 Cell，并将其加载到 BlockCache 中，然后从 BlockCache 中读取。</p><p><img loading="lazy" alt="hbasearch20.png" src="/assets/images/hbasearch20-97ba03585d70c70e1ae87ba9788014de.png" width="535" height="225" class="img_ev3q"></p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="hbase-compaction">HBase Compaction<a href="#hbase-compaction" class="hash-link" aria-label="HBase Compaction的直接链接" title="HBase Compaction的直接链接">​</a></h3><p>compaction 分为两种：</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="minor-compact">minor compact<a href="#minor-compact" class="hash-link" aria-label="minor compact的直接链接" title="minor compact的直接链接">​</a></h3><p>选取一些小的、相邻的 hfile 合并成一个更大的 hfile，在这个过程中不会处理已经 deleted 或 expired 的 cell;</p><p><img loading="lazy" alt="hbasearch21.png" src="/assets/images/hbasearch21-4526039025c444589036ca796ec1bf05.png" width="510" height="224" class="img_ev3q"></p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="major-compact">major compact<a href="#major-compact" class="hash-link" aria-label="major compact的直接链接" title="major compact的直接链接">​</a></h3><p>所有的 hfile 合并成一个 hfile，在这个过程中，标记为 deleted 的 cell 会被删除，而那些已经 expired 的 cell 会被丢弃。major compaction 的结果是一个 HStore 只有一个 hfile 存在(one hfile per column family)。可以手动或自动触发，由于它会引起很多的 IO 操作而影响性能，一般建议安排在周末等比较闲的时间。</p><p><img loading="lazy" alt="hbasearch22.png" src="/assets/images/hbasearch22-be0fef275a19b8f030e2cef2d476c54f.png" width="461" height="230" class="img_ev3q"></p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="hdfs-data-replication">HDFS Data Replication<a href="#hdfs-data-replication" class="hash-link" aria-label="HDFS Data Replication的直接链接" title="HDFS Data Replication的直接链接">​</a></h3><p>hbase 依赖 hdfs 来确保数据不丢失，hdfs 将数据备份到其他节点上。</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="hbase-crash-recovery">HBase Crash Recovery<a href="#hbase-crash-recovery" class="hash-link" aria-label="HBase Crash Recovery的直接链接" title="HBase Crash Recovery的直接链接">​</a></h3><p>当 zookeeper 监测不到 regionserver 的心跳包，通知 master 这个 regionserver 宕机。master 就会对宕机 server 中的 region 分配给活着的 regionserver。</p><p><img loading="lazy" alt="hbasearch23.png" src="/assets/images/hbasearch23-becaa71be6f0e0e07d4e95fca24a6983.png" width="509" height="252" class="img_ev3q"></p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="参考">参考<a href="#参考" class="hash-link" aria-label="参考的直接链接" title="参考的直接链接">​</a></h2><p><a href="http://www.blogjava.net/DLevin/archive/2015/08/22/426877.html" target="_blank" rel="noopener noreferrer">深入 HBase 架构解析</a></p></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="theme-doc-footer-edit-meta-row row"><div class="col"><a href="https://github.com/yoloz/yolo-docs/tree/docusaurus/docs/bigdata/hbase学习.md" target="_blank" rel="noreferrer noopener" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_Z9Sw" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>编辑此页</a></div><div class="col lastUpdated_vwxv"></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="文档分页导航"><a class="pagination-nav__link pagination-nav__link--prev" href="/docs/bigdata/hadoop安装"><div class="pagination-nav__sublabel">上一页</div><div class="pagination-nav__label">hadoop安装</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/docs/bigdata/hbase安装"><div class="pagination-nav__sublabel">下一页</div><div class="pagination-nav__label">hbase安装</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#regions" class="table-of-contents__link toc-highlight">Regions</a><ul><li><a href="#region" class="table-of-contents__link toc-highlight">Region</a></li><li><a href="#region-split" class="table-of-contents__link toc-highlight">Region Split</a></li><li><a href="#read-load-balancing" class="table-of-contents__link toc-highlight">Read Load Balancing</a></li></ul></li><li><a href="#hbase-hmaster" class="table-of-contents__link toc-highlight">HBase Hmaster</a><ul><li><a href="#zookeeper-the-coordinator" class="table-of-contents__link toc-highlight">ZooKeeper: The Coordinator</a></li><li><a href="#how-the-components-work-together" class="table-of-contents__link toc-highlight">How the Components Work Together</a></li><li><a href="#hbase-first-read-or-write" class="table-of-contents__link toc-highlight">HBase First Read or Write</a></li><li><a href="#hbase-meta-table" class="table-of-contents__link toc-highlight">HBase Meta Table</a></li><li><a href="#region-server-components" class="table-of-contents__link toc-highlight">Region Server Components</a></li><li><a href="#hbase-write" class="table-of-contents__link toc-highlight">HBase Write</a></li><li><a href="#hbase-memstore" class="table-of-contents__link toc-highlight">HBase MemStore</a></li><li><a href="#hbase-region-flush" class="table-of-contents__link toc-highlight">HBase Region Flush</a></li><li><a href="#hbase-hfile" class="table-of-contents__link toc-highlight">HBase HFile</a></li><li><a href="#hbase-hfile-structure" class="table-of-contents__link toc-highlight">HBase HFile Structure</a></li><li><a href="#hbase-read-merge" class="table-of-contents__link toc-highlight">HBase Read Merge</a></li><li><a href="#hbase-compaction" class="table-of-contents__link toc-highlight">HBase Compaction</a></li><li><a href="#minor-compact" class="table-of-contents__link toc-highlight">minor compact</a></li><li><a href="#major-compact" class="table-of-contents__link toc-highlight">major compact</a></li><li><a href="#hdfs-data-replication" class="table-of-contents__link toc-highlight">HDFS Data Replication</a></li><li><a href="#hbase-crash-recovery" class="table-of-contents__link toc-highlight">HBase Crash Recovery</a></li></ul></li><li><a href="#参考" class="table-of-contents__link toc-highlight">参考</a></li></ul></div></div></div></div></main></div></div><footer class="footer"><div class="container container-fluid"><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2023 yolo. Built with ❤️ using Docusaurus.</div></div></div></footer></div>
<script src="/assets/js/runtime~main.d0f6cce0.js"></script>
<script src="/assets/js/main.d0f70bc6.js"></script>
</body>
</html>