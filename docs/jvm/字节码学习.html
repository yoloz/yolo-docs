<!doctype html>
<html lang="zh-Hans" dir="ltr" class="docs-wrapper docs-doc-page docs-version-current plugin-docs plugin-id-default docs-doc-id-jvm/字节码学习" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v2.4.3">
<title data-rh="true">字节码学习 | Docs</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="https://www.ylsite.tk/docs/jvm/字节码学习"><meta data-rh="true" name="docusaurus_locale" content="zh-Hans"><meta data-rh="true" name="docsearch:language" content="zh-Hans"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="字节码学习 | Docs"><meta data-rh="true" name="description" content="原文"><meta data-rh="true" property="og:description" content="原文"><link data-rh="true" rel="icon" href="/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://www.ylsite.tk/docs/jvm/字节码学习"><link data-rh="true" rel="alternate" href="https://www.ylsite.tk/docs/jvm/字节码学习" hreflang="zh-Hans"><link data-rh="true" rel="alternate" href="https://www.ylsite.tk/docs/jvm/字节码学习" hreflang="x-default"><link rel="alternate" type="application/rss+xml" href="/blog/rss.xml" title="Docs RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/blog/atom.xml" title="Docs Atom Feed"><link rel="stylesheet" href="/assets/css/styles.e72108b9.css">
<link rel="preload" href="/assets/js/runtime~main.9ea4dce1.js" as="script">
<link rel="preload" href="/assets/js/main.6b7da298.js" as="script">
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}return t}()||function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div role="region" aria-label="跳到主要内容"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">跳到主要内容</a></div><nav aria-label="主导航" class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="切换导航栏" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/img/logo.png" alt="yolo-docs Logo" class="themedImage_ToTc themedImage--light_HNdA"><img src="/img/logo.png" alt="yolo-docs Logo" class="themedImage_ToTc themedImage--dark_i4oU"></div><b class="navbar__title text--truncate">yolo-docs</b></a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/docs/About">文档</a><a class="navbar__item navbar__link" href="/blog">博客</a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/yoloz/yolo-docs" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link header-github-link" aria-label="GitHub repository"></a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="切换浅色/暗黑模式（当前为浅色模式）" aria-label="切换浅色/暗黑模式（当前为浅色模式）" aria-live="polite"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="searchBox_ZlJk"><div class="navbar__search searchBarContainer_NW3z"><input placeholder="搜索" aria-label="Search" class="navbar__search-input"><div class="loadingRing_RJI3 searchBarLoadingRing_YnHq"><div></div><div></div><div></div><div></div></div><div class="searchHintContainer_Pkmr"><kbd class="searchHint_iIMx">ctrl</kbd><kbd class="searchHint_iIMx">K</kbd></div></div></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0 docsWrapper_BCFX"><button aria-label="回到顶部" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docPage__5DB"><aside class="theme-doc-sidebar-container docSidebarContainer_b6E3"><div class="sidebarViewport_Xe31"><div class="sidebar_njMd"><nav aria-label="文档侧边栏" class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/About">About</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/docs/AI&amp;ML/machine learning">AI&amp;ML</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/docs/bigdata/CDH使用">bigdata</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/docs/concept/RESTful学习">concept</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/docs/concurrent/JAVA的锁学习">concurrent</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/docs/database/ES-SQL">database</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/docs/devOps/su与sudo">devOps</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/docs/docker/dockerfile学习">docker</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/docs/forend/HTML知识点">forend</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/docs/golang/defer及异常处理">golang</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/docs/java/EventBus使用">java</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret menu__link--active" aria-expanded="true" href="/docs/jvm/JNA中乱码和释放内存">jvm</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/jvm/JNA中乱码和释放内存">JNA中乱码和释放内存</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/jvm/JNA指针类型映射关系">JNA指针类型映射关系</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/jvm/JNA简单类型使用">JNA简单类型使用</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/jvm/JNA结构体类型使用">JNA结构体类型使用</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/jvm/JNI使用">JNI使用</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/jvm/jvm启动参数">jvm启动参数</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/jvm/jvm调试工具">jvm调试工具</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/jvm/threadDump分析">threadDump分析</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/jvm/加载库文件">加载库文件</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/jvm/字节码增强-asm">字节码增强-asm</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/jvm/字节码增强-aspectj">字节码增强-aspectj</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/jvm/字节码增强-instrument">字节码增强-instrument</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/jvm/字节码增强-javassist">字节码增强-javassist</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/jvm/字节码增强-代理">字节码增强-代理</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/jvm/字节码增强概述">字节码增强概述</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/docs/jvm/字节码学习">字节码学习</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/docs/linux/AIpine系统">linux</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/docs/maven/maven-checkstyle-plugin">maven</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/docs/netty/了解netty写">netty</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/docs/network/cksum问题">network</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/docs/react/react-loadable代码分割">react</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/docs/security/SSL双向认证实现">security</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/docs/shell/bash和bat">shell</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/docs/spring/cache的使用">spring</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/docs/tools/IDE安装字体">tools</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/docs/vue/el-select下拉框验证">vue</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/docs/window/nsis安装包制作">window</a></div></li></ul></nav></div></div></aside><main class="docMainContainer_gTbr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="页面路径"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="主页面" class="breadcrumbs__link" href="/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_YNFT"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li class="breadcrumbs__item"><span class="breadcrumbs__link">jvm</span><meta itemprop="position" content="1"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">字节码学习</span><meta itemprop="position" content="2"></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">本页总览</button></div><div class="theme-doc-markdown markdown"><header><h1>字节码学习</h1></header><p><a href="https://segmentfault.com/a/1190000020345321?utm_source=tag-newest" target="_blank" rel="noopener noreferrer">原文</a></p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="什么是字节码">什么是字节码？<a href="#什么是字节码" class="hash-link" aria-label="什么是字节码？的直接链接" title="什么是字节码？的直接链接">​</a></h2><p>Java 之所以可以“一次编译，到处运行”，一是因为 JVM 针对各种操作系统、平台都进行了定制，二是因为无论在什么平台，都可以编译生成固定格式的字节码（.class 文件）供 JVM 使用。因此，也可以看出字节码对于 Java 生态的重要性。之所以被称之为字节码，是因为字节码文件由十六进制值组成，而 JVM 以两个十六进制值为一组，即以字节为单位进行读取。在 Java 中一般是用 javac 命令编译源代码为字节码文件，一个.java 文件从编译到运行的示例如图 1 所示。</p><p><img loading="lazy" alt="class1.png" src="/assets/images/class1-526340787abe4e15b2c01e57d9fdf163.png" width="482" height="215" class="img_ev3q">
图 1 Java 运行示意图</p><p>对于开发人员，了解字节码可以更准确、直观地理解 Java 语言中更深层次的东西，比如通过字节码，可以很直观地看到 Volatile 关键字如何在字节码上生效。另外，字节码增强技术在 Spring AOP、各种 ORM 框架、热部署中的应用屡见不鲜，深入理解其原理对于我们来说大有裨益。除此之外，由于 JVM 规范的存在，只要最终可以生成符合规范的字节码就可以在 JVM 上运行，因此这就给了各种运行在 JVM 上的语言（如 Scala、Groovy、Kotlin）一种契机，可以扩展 Java 所没有的特性或者实现各种语法糖。理解字节码后再学习这些语言，可以“逆流而上”，从字节码视角看它的设计思路，学习起来也“易如反掌”。</p><p>本文重点着眼于字节码增强技术，从字节码开始逐层向上，由 JVM 字节码操作集合到 Java 中操作字节码的框架，再到我们熟悉的各类框架原理及应用，也都会一一进行介绍。</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="字节码结构">字节码结构<a href="#字节码结构" class="hash-link" aria-label="字节码结构的直接链接" title="字节码结构的直接链接">​</a></h2><p>.java 文件通过 javac 编译后将得到一个.class 文件，比如编写一个简单的 ByteCodeDemo 类，如下图 2 的左侧部分：</p><p><img loading="lazy" alt="class2.png" src="/assets/images/class2-887766cd9736f2cb8cb5db7be3e82872.png" width="600" height="214" class="img_ev3q">
图 2 示例代码（左侧）及对应的字节码（右侧）</p><p>编译后生成 ByteCodeDemo.class 文件，打开后是一堆十六进制数，按字节为单位进行分割后展示如图 2 右侧部分所示。上文提及过，JVM 对于字节码是有规范要求的，那么看似杂乱的十六进制符合什么结构呢？JVM 规范要求每一个字节码文件都要由十部分按照固定的顺序组成，整体结构如图 3 所示。接下来我们将一一介绍这十部分：</p><p><img loading="lazy" alt="class3.png" src="/assets/images/class3-51da18bb659e41613eae8d9faabd7ca8.png" width="520" height="267" class="img_ev3q">
图 3 JVM 规定的字节码结构</p><p>（1） 魔数（Magic Number）</p><p>所有的.class 文件的前四个字节都是魔数，魔数的固定值为：0xCAFEBABE。魔数放在文件开头，JVM 可以根据文件的开头来判断这个文件是否可能是一个.class 文件，如果是，才会继续进行之后的操作。</p><p>有趣的是，魔数的固定值是 Java 之父 James Gosling 制定的，为 CafeBabe（咖啡宝贝），而 Java 的图标为一杯咖啡。
（2） 版本号</p><p>版本号为魔数之后的 4 个字节，前两个字节表示次版本号（Minor Version），后两个字节表示主版本号（Major Version）。上图 2 中版本号为“00 00 00 34”，次版本号转化为十进制为 0，主版本号转化为十进制为 52，在 Oracle 官网中查询序号 52 对应的主版本号为 1.8，所以编译该文件的 Java 版本号为 1.8.0。</p><p>（3） 常量池（Constant Pool）</p><p>紧接着主版本号之后的字节为常量池入口。常量池中存储两类常量：字面量与符号引用。字面量为代码中声明为 Final 的常量值，符号引用如类和接口的全局限定名、字段的名称和描述符、方法的名称和描述符。常量池整体上分为两部分：常量池计数器以及常量池数据区，如下图 4 所示。</p><p><img loading="lazy" alt="class4.png" src="/assets/images/class4-675a356cb012f2322376878fc0761fa1.png" width="466" height="121" class="img_ev3q">
图 4 常量池的结构</p><p>常量池计数器（constant_pool_count）：由于常量的数量不固定，所以需要先放置两个字节来表示常量池容量计数值。图 2 中示例代码的字节码前 10 个字节如下图 5 所示，将十六进制的 24 转化为十进制值为 36，排除掉下标“0”，也就是说，这个类文件中共有 35 个常量。</p><p><img loading="lazy" alt="class5.png" src="data:image/png;base64,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" width="284" height="72" class="img_ev3q">
图 5 前十个字节及含义</p><p>常量池数据区：数据区是由（constant_pool_count-1）个 cp_info 结构组成，一个 cp_info 结构对应一个常量。在字节码中共有 14 种类型的 cp_info（如下图 6 所示），每种类型的结构都是固定的。</p><p><img loading="lazy" alt="class6.png" src="/assets/images/class6-53e1ef826a435bb4646cf4e6e7474005.png" width="496" height="570" class="img_ev3q">
图 6 各类型的 cp_info</p><p>具体以 CONSTANT_utf8_info 为例，它的结构如下图 7 左侧所示。首先一个字节“tag”，它的值取自上图 6 中对应项的 Tag，由于它的类型是 utf8_info，所以值为“01”。接下来两个字节标识该字符串的长度 Length，然后 Length 个字节为这个字符串具体的值。从图 2 中的字节码摘取一个 cp_info 结构，如下图 7 右侧所示。将它翻译过来后，其含义为：该常量类型为 utf8 字符串，长度为一字节，数据为“a”。</p><p><img loading="lazy" alt="class7.png" src="/assets/images/class7-22c901e88f0659ac9efcc2fddd98be26.png" width="594" height="146" class="img_ev3q">
图 7 CONSTANT_utf8_info 的结构（左）及示例（右）</p><p>其他类型的 cp_info 结构在本文不再赘述，整体结构大同小异，都是先通过 Tag 来标识类型，然后后续 n 个字节来描述长度和（或）数据。先知其所以然，以后可以通过 javap -verbose ByteCodeDemo 命令，查看 JVM 反编译后的完整常量池，如下图 8 所示。可以看到反编译结果将每一个 cp_info 结构的类型和值都很明确地呈现了出来。</p><p><img loading="lazy" alt="class8.png" src="/assets/images/class8-740f348864c1cafc0e51ddc9316aa010.png" width="424" height="465" class="img_ev3q">
图 8 常量池反编译结果</p><p>（4） 访问标志</p><p>常量池结束之后的两个字节，描述该 Class 是类还是接口，以及是否被 Public、Abstract、Final 等修饰符修饰。JVM 规范规定了如下图 9 的访问标志（Access_Flag）。需要注意的是，JVM 并没有穷举所有的访问标志，而是使用按位或操作来进行描述的，比如某个类的修饰符为 Public Final，则对应的访问修饰符的值为 ACC_PUBLIC | ACC_FINAL，即 0x0001 | 0x0010=0x0011。</p><p><img loading="lazy" alt="class9.png" src="/assets/images/class9-e18e926dda76f753fe342a8a7bc2199e.png" width="454" height="480" class="img_ev3q">
图 9 访问标志</p><p>（5） 当前类名</p><p>访问标志后的两个字节，描述的是当前类的全限定名。这两个字节保存的值为常量池中的索引值，根据索引值就能在常量池中找到这个类的全限定名。</p><p>（6） 父类名称</p><p>当前类名后的两个字节，描述父类的全限定名，同上，保存的也是常量池中的索引值。</p><p>（7） 接口信息</p><p>父类名称后为两字节的接口计数器，描述了该类或父类实现的接口数量。紧接着的 n 个字节是所有接口名称的字符串常量的索引值。</p><p>（8） 字段表</p><p>字段表用于描述类和接口中声明的变量，包含类级别的变量以及实例变量，但是不包含方法内部声明的局部变量。字段表也分为两部分，第一部分为两个字节，描述字段个数；第二部分是每个字段的详细信息 fields_info。字段表结构如下图所示：</p><p><img loading="lazy" alt="class10.png" src="/assets/images/class10-b60679c87d771a63d7c6538e9e8fd892.png" width="354" height="374" class="img_ev3q">
图 10 字段表结构</p><p>以图 2 中字节码的字段表为例，如下图 11 所示。其中字段的访问标志查图 9，0002 对应为 Private。通过索引下标在图 8 中常量池分别得到字段名为“a”，描述符为“I”（代表 int）。综上，就可以唯一确定出一个类中声明的变量 private int a。</p><p><img loading="lazy" alt="class11.png" src="/assets/images/class11-ba9c32fef93095c1d917bdf3a125964e.png" width="354" height="127" class="img_ev3q">
图 11 字段表示例</p><p>（9）方法表</p><p>字段表结束后为方法表，方法表也是由两部分组成，第一部分为两个字节描述方法的个数；第二部分为每个方法的详细信息。方法的详细信息较为复杂，包括方法的访问标志、方法名、方法的描述符以及方法的属性，如下图所示：</p><p><img loading="lazy" alt="class12.png" src="/assets/images/class12-4e041c526d25bde62a1035989b7cd074.png" width="432" height="141" class="img_ev3q">
图 12 方法表结构</p><p>方法的权限修饰符依然可以通过图 9 的值查询得到，方法名和方法的描述符都是常量池中的索引值，可以通过索引值在常量池中找到。而“方法的属性”这一部分较为复杂，直接借助 javap -verbose 将其反编译为人可以读懂的信息进行解读，如图 13 所示。可以看到属性中包括以下三个部分：</p><p>“Code 区”：源代码对应的 JVM 指令操作码，在进行字节码增强时重点操作的就是“Code 区”这一部分。
“LineNumberTable”：行号表，将 Code 区的操作码和源代码中的行号对应，Debug 时会起到作用（源代码走一行，需要走多少个 JVM 指令操作码）。
“LocalVariableTable”：本地变量表，包含 This 和局部变量，之所以可以在每一个方法内部都可以调用 This，是因为 JVM 将 This 作为每一个方法的第一个参数隐式进行传入。当然，这是针对非 Static 方法而言。</p><p><img loading="lazy" alt="class13.png" src="/assets/images/class13-501f995674d86faa2ac10154b8411c10.png" width="464" height="400" class="img_ev3q">
图 13 反编译后的方法表</p><p>（10）附加属性表</p><p>字节码的最后一部分，该项存放了在该文件中类或接口所定义属性的基本信息。</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="字节码操作集合">字节码操作集合<a href="#字节码操作集合" class="hash-link" aria-label="字节码操作集合的直接链接" title="字节码操作集合的直接链接">​</a></h2><p>在上图 13 中，Code 区的红色编号 0 ～ 17，就是.java 中的方法源代码编译后让 JVM 真正执行的操作码。为了帮助人们理解，反编译后看到的是十六进制操作码所对应的助记符，十六进制值操作码与助记符的对应关系，以及每一个操作码的用处可以查看 Oracle 官方文档进行了解，在需要用到时进行查阅即可。比如上图中第一个助记符为 iconst_2，对应到图 2 中的字节码为 0x05，用处是将 int 值 2 压入操作数栈中。以此类推，对 0~17 的助记符理解后，就是完整的 add()方法的实现。</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="操作数栈和字节码">操作数栈和字节码<a href="#操作数栈和字节码" class="hash-link" aria-label="操作数栈和字节码的直接链接" title="操作数栈和字节码的直接链接">​</a></h2><p>JVM 的指令集是基于栈而不是寄存器，基于栈可以具备很好的跨平台性（因为寄存器指令集往往和硬件挂钩），但缺点在于，要完成同样的操作，基于栈的实现需要更多指令才能完成（因为栈只是一个 FILO 结构，需要频繁压栈出栈）。另外，由于栈是在内存实现的，而寄存器是在 CPU 的高速缓存区，相较而言，基于栈的速度要慢很多，这也是为了跨平台性而做出的牺牲。</p><p>我们在上文所说的操作码或者操作集合，其实控制的就是这个 JVM 的操作数栈。为了更直观地感受操作码是如何控制操作数栈的，以及理解常量池、变量表的作用，将 add()方法的对操作数栈的操作制作为 GIF，如下图 14 所示，图中仅截取了常量池中被引用的部分，以指令 iconst_2 开始到 ireturn 结束，与图 13 中 Code 区 0~17 的指令一一对应：</p><p><img loading="lazy" alt="class14.gif" src="/assets/images/class14-01e74fdf1b7edcc46c7bc769875f57a5.gif" width="580" height="262" class="img_ev3q">
图 14 控制操作数栈示意图</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="查看字节码工具">查看字节码工具<a href="#查看字节码工具" class="hash-link" aria-label="查看字节码工具的直接链接" title="查看字节码工具的直接链接">​</a></h2><p>如果每次查看反编译后的字节码都使用 javap 命令的话，好非常繁琐。这里推荐一个 Idea 插件：jclasslib。使用效果如图 15 所示，代码编译后在菜单栏&quot;View&quot;中选择&quot;Show Bytecode With jclasslib&quot;，可以很直观地看到当前字节码文件的类信息、常量池、方法区等信息。</p><p><img loading="lazy" alt="class15.png" src="/assets/images/class15-e8bde4ee28fd686c86ecfd82edbdd24a.png" width="532" height="251" class="img_ev3q">
图 15 jclasslib 查看字节码</p></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="theme-doc-footer-edit-meta-row row"><div class="col"><a href="https://github.com/yoloz/yolo-docs/tree/docusaurus/docs/jvm/字节码学习.md" target="_blank" rel="noreferrer noopener" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_Z9Sw" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>编辑此页</a></div><div class="col lastUpdated_vwxv"></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="文件选项卡"><a class="pagination-nav__link pagination-nav__link--prev" href="/docs/jvm/字节码增强概述"><div class="pagination-nav__sublabel">上一页</div><div class="pagination-nav__label">字节码增强概述</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/docs/linux/AIpine系统"><div class="pagination-nav__sublabel">下一页</div><div class="pagination-nav__label">AIpine系统</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#什么是字节码" class="table-of-contents__link toc-highlight">什么是字节码？</a></li><li><a href="#字节码结构" class="table-of-contents__link toc-highlight">字节码结构</a></li><li><a href="#字节码操作集合" class="table-of-contents__link toc-highlight">字节码操作集合</a></li><li><a href="#操作数栈和字节码" class="table-of-contents__link toc-highlight">操作数栈和字节码</a></li><li><a href="#查看字节码工具" class="table-of-contents__link toc-highlight">查看字节码工具</a></li></ul></div></div></div></div></main></div></div><footer class="footer"><div class="container container-fluid"><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2024 yolo. Built with ❤️ using Docusaurus.</div></div></div></footer></div>
<script src="/assets/js/runtime~main.9ea4dce1.js"></script>
<script src="/assets/js/main.6b7da298.js"></script>
</body>
</html>