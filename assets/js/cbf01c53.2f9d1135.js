"use strict";(self.webpackChunkyolo_docs=self.webpackChunkyolo_docs||[]).push([[2985],{3905:(e,n,t)=>{t.d(n,{Zo:()=>c,kt:()=>k});var a=t(67294);function r(e,n,t){return n in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}function o(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);n&&(a=a.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),t.push.apply(t,a)}return t}function p(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?o(Object(t),!0).forEach((function(n){r(e,n,t[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):o(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}))}return e}function s(e,n){if(null==e)return{};var t,a,r=function(e,n){if(null==e)return{};var t,a,r={},o=Object.keys(e);for(a=0;a<o.length;a++)t=o[a],n.indexOf(t)>=0||(r[t]=e[t]);return r}(e,n);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(a=0;a<o.length;a++)t=o[a],n.indexOf(t)>=0||Object.prototype.propertyIsEnumerable.call(e,t)&&(r[t]=e[t])}return r}var l=a.createContext({}),i=function(e){var n=a.useContext(l),t=n;return e&&(t="function"==typeof e?e(n):p(p({},n),e)),t},c=function(e){var n=i(e.components);return a.createElement(l.Provider,{value:n},e.children)},u="mdxType",d={inlineCode:"code",wrapper:function(e){var n=e.children;return a.createElement(a.Fragment,{},n)}},m=a.forwardRef((function(e,n){var t=e.components,r=e.mdxType,o=e.originalType,l=e.parentName,c=s(e,["components","mdxType","originalType","parentName"]),u=i(t),m=r,k=u["".concat(l,".").concat(m)]||u[m]||d[m]||o;return t?a.createElement(k,p(p({ref:n},c),{},{components:t})):a.createElement(k,p({ref:n},c))}));function k(e,n){var t=arguments,r=n&&n.mdxType;if("string"==typeof e||r){var o=t.length,p=new Array(o);p[0]=m;var s={};for(var l in n)hasOwnProperty.call(n,l)&&(s[l]=n[l]);s.originalType=e,s[u]="string"==typeof e?e:r,p[1]=s;for(var i=2;i<o;i++)p[i]=t[i];return a.createElement.apply(null,p)}return a.createElement.apply(null,t)}m.displayName="MDXCreateElement"},29434:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>l,contentTitle:()=>p,default:()=>d,frontMatter:()=>o,metadata:()=>s,toc:()=>i});var a=t(87462),r=(t(67294),t(3905));const o={},p=void 0,s={unversionedId:"tools/openvpn\u5b89\u88c5",id:"tools/openvpn\u5b89\u88c5",title:"openvpn\u5b89\u88c5",description:"openvpn Access Server",source:"@site/docs/tools/openvpn\u5b89\u88c5.md",sourceDirName:"tools",slug:"/tools/openvpn\u5b89\u88c5",permalink:"/docs/tools/openvpn\u5b89\u88c5",draft:!1,editUrl:"https://github.com/yoloz/yolo-docs/tree/docusaurus/docs/tools/openvpn\u5b89\u88c5.md",tags:[],version:"current",frontMatter:{},sidebar:"tutorialSidebar",previous:{title:"nginx\u914d\u7f6e",permalink:"/docs/tools/nginx\u914d\u7f6e"},next:{title:"svn\u5e38\u7528\u64cd\u4f5c",permalink:"/docs/tools/svn\u5e38\u7528\u64cd\u4f5c"}},l={},i=[{value:"openvpn Access Server",id:"openvpn-access-server",level:2},{value:"\u79bb\u7ebf\u5b89\u88c5",id:"\u79bb\u7ebf\u5b89\u88c5",level:3},{value:"\u5728\u7ebf\u5b89\u88c5(debian)",id:"\u5728\u7ebf\u5b89\u88c5debian",level:3},{value:"openvpn",id:"openvpn",level:2}],c={toc:i},u="wrapper";function d(e){let{components:n,...t}=e;return(0,r.kt)(u,(0,a.Z)({},c,t,{components:n,mdxType:"MDXLayout"}),(0,r.kt)("h2",{id:"openvpn-access-server"},"openvpn Access Server"),(0,r.kt)("h3",{id:"\u79bb\u7ebf\u5b89\u88c5"},"\u79bb\u7ebf\u5b89\u88c5"),(0,r.kt)("p",null,(0,r.kt)("a",{parentName:"p",href:"https://openvpn.net/quick-start-guide/"},"https://openvpn.net/quick-start-guide/")),(0,r.kt)("ol",null,(0,r.kt)("li",{parentName:"ol"},"Install \u2018openvpn-as\u2019 package"),(0,r.kt)("li",{parentName:"ol"},"Get the password for the Admin Web UI"),(0,r.kt)("li",{parentName:"ol"},"Set up in browser: https://","[youripaddress]","/admin")),(0,r.kt)("admonition",{type:"note"},(0,r.kt)("pre",{parentName:"admonition"},(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"yolo@rkn:~$ sudo dpkg -i openvpn-as-bundled-clients-latest.deb\nyolo@rkn:~$ sudo dpkg -i openvpn-as-latest-debian11.amd_64.deb\n#\u5b89\u88c5\u7f3a\u5c11\u7684\u4f9d\u8d56\nyolo@rkn:~$ sudo apt install -f\n")),(0,r.kt)("p",{parentName:"admonition"},"\u767b\u9646 ",(0,r.kt)("inlineCode",{parentName:"p"},"https://[youripaddress]/")," \u540e\u53ef\u4ee5\u4fee\u6539\u751f\u6210\u7684\u968f\u673a\u5bc6\u7801")),(0,r.kt)("h3",{id:"\u5728\u7ebf\u5b89\u88c5debian"},"\u5728\u7ebf\u5b89\u88c5(debian)"),(0,r.kt)("p",null,(0,r.kt)("a",{parentName:"p",href:"https://as-portal.openvpn.com/get-access-server"},"https://as-portal.openvpn.com/get-access-server")),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"Install via Repository")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},'sudo apt update && sudo apt -y install ca-certificates wget net-tools gnupg\n\nsudo wget https://as-repository.openvpn.net/as-repo-public.asc -qO /etc/apt/trusted.gpg.d/as-repository.asc\n\necho "deb [arch=amd64 signed-by=/etc/apt/trusted.gpg.d/as-repository.asc] http://as-repository.openvpn.net/as/debian bullseye main">/etc/apt/sources.list.d/openvpn-as-repo.list\n#\u6ca1\u6743\u9650\uff1a\u5148sudo\u521b\u5efa\u6587\u4ef6\uff0c\u7136\u540esudo\u7f16\u8f91\u6587\u4ef6\n\nsudo apt update && sudo apt -y install openvpn-as\n')),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"Manually download packages")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"sudo apt update\n\nsudo apt install -y bridge-utils dmidecode iptables iproute2 libc6 libffi7 libgcc-s1 liblz4-1 liblzo2-2 libmariadb3 libpcap0.8 libssl1.1 libstdc++6 zlib1g libsasl2-2 libsqlite3-0 net-tools python3-pkg-resources python3-migrate python3-sqlalchemy python3-mysqldb python3-ldap3 sqlite3 python3-netaddr python3-arrow python3-lxml python3-openssl python3-incremental libxmlsec1 libxmlsec1-openssl python3-constantly python3-hyperlink python3-automat python3-service-identity python3-cffi python3-defusedxml\n\nsudo dpkg -i openvpn-as-bundled-clients-27.deb openvpn-as_2.11.3-af31575c-Debian11_amd64.deb\n")),(0,r.kt)("h2",{id:"openvpn"},"openvpn"),(0,r.kt)("p",null,"\u6e90\u6587\uff1a",(0,r.kt)("a",{parentName:"p",href:"https://dev.to/baptistsec/building-your-own-vpn-for-free-3o9h"},"Building Your Own VPN for Free")),(0,r.kt)("ol",null,(0,r.kt)("li",{parentName:"ol"},"Install OpenVPN and Easy-RSA")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"sudo apt update\nsudo apt install openvpn\nsudo apt-get install easy-rsa\n")),(0,r.kt)("ol",{start:2},(0,r.kt)("li",{parentName:"ol"},"Configuration")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"# Generate the server\u2019s certificates and keys:\ncd /usr/share/easy-rsa\nsudo ./easyrsa init-pki\nsudo ./easyrsa build-ca\nsudo ./easyrsa gen-req server nopass\nsudo ./easyrsa sign-req server server\n")),(0,r.kt)("blockquote",null,(0,r.kt)("p",{parentName:"blockquote"},"During above process, when prompted, you will need to set a password and server username.")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"# after above,the server is setup, generate the Diffie-Hellman key exchange\nsudo openssl dhparam -out /etc/openvpn/dh.pem 2048\n# and then need to generate an HMAC signature for a strengthened control channel\nsudo openvpn --genkey secret /etc/openvpn/ta.key\n")),(0,r.kt)("ol",{start:3},(0,r.kt)("li",{parentName:"ol"},"Server Configuration")),(0,r.kt)("p",null,"Create a server configuration file ",(0,r.kt)("inlineCode",{parentName:"p"},"/etc/openvpn/server.conf")," and add the following lines:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-log"},'port 1194\nproto udp\ndev tun\nca /etc/openvpn/easy-rsa/pki/ca.crt\ncert /etc/openvpn/easy-rsa/pki/issued/server.crt\nkey /etc/openvpn/easy-rsa/pki/private/server.key\ndh /etc/openvpn/dh.pem\ntls-auth /etc/openvpn/ta.key 0\nserver 10.8.0.0 255.255.255.0\nifconfig-pool-persist /etc/openvpn/ipp.txt\npush "redirect-gateway def1 bypass-dhcp"\npush "dhcp-option DNS 8.8.8.8"\nuser nobody\ngroup nogroup\npersist-key\npersist-tun\nstatus /var/log/openvpn-status.log\nverb 3\n')),(0,r.kt)("ol",{start:4},(0,r.kt)("li",{parentName:"ol"},"Enable IP Forwarding")),(0,r.kt)("p",null,"Uncomment the following line in ",(0,r.kt)("inlineCode",{parentName:"p"},"/etc/sysctl.conf")," to enable IP forwarding",(0,r.kt)("inlineCode",{parentName:"p"},"net.ipv4.ip_forward=1")),(0,r.kt)("p",null,"activate the changes:",(0,r.kt)("inlineCode",{parentName:"p"},"sudo sysctl -p")),(0,r.kt)("ol",{start:5},(0,r.kt)("li",{parentName:"ol"},"Firewall Configuration")),(0,r.kt)("p",null,"Configure the firewall to allow VPN traffic:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"sudo ufw allow 1194/udp\nsudo ufw allow OpenSSH\nsudo ufw enable\n")),(0,r.kt)("ol",{start:7},(0,r.kt)("li",{parentName:"ol"},"Client Configuration")),(0,r.kt)("p",null,"Generate client keys:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"cd /usr/share/easy-rsa\nsudo ./easyrsa gen-req client nopass\nsudo ./easyrsa sign-req client client\n")),(0,r.kt)("blockquote",null,(0,r.kt)("p",{parentName:"blockquote"},"During this process, you will again enter the username and use \u201cuser\u201d as a placeholder. Then, once prompted, type the word \u2018yes\u2019 and enter the password we used earlier in Step 2 for the server\u2019s certificates and keys setup.")),(0,r.kt)("p",null,"Lastly, create a client configuration file named client.ovpn in ",(0,r.kt)("inlineCode",{parentName:"p"},"/etc/openvpn/")," :"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-log"},"client\ndev tun\nproto udp\nremote your_server_ip 1194\nresolv-retry infinite\nnobind\npersist-key\npersist-tun\nkey-direction 1\nremote-cert-tls server\ntls-auth ta.key 1\ndata-ciphers AES-256-GCM:AES-128-GCM\nverb 3\n")),(0,r.kt)("blockquote",null,(0,r.kt)("p",{parentName:"blockquote"},"Copy down the client certificates and keys to your local machine.")),(0,r.kt)("ol",{start:7},(0,r.kt)("li",{parentName:"ol"},"Connecting to the VPN")),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"Use OpenVPN on your local machine to connect to your VPN server:",(0,r.kt)("inlineCode",{parentName:"li"},"openvpn --config client.ovpn"),"\uff1b"),(0,r.kt)("li",{parentName:"ul"},"\u56fe\u5f62\u5316\u5de5\u5177\uff1b")))}d.isMDXComponent=!0}}]);