"use strict";(self.webpackChunkyolo_docs=self.webpackChunkyolo_docs||[]).push([[1959],{3905:(t,e,r)=>{r.d(e,{Zo:()=>l,kt:()=>y});var n=r(67294);function p(t,e,r){return e in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}function c(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),r.push.apply(r,n)}return r}function i(t){for(var e=1;e<arguments.length;e++){var r=null!=arguments[e]?arguments[e]:{};e%2?c(Object(r),!0).forEach((function(e){p(t,e,r[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):c(Object(r)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(r,e))}))}return t}function o(t,e){if(null==t)return{};var r,n,p=function(t,e){if(null==t)return{};var r,n,p={},c=Object.keys(t);for(n=0;n<c.length;n++)r=c[n],e.indexOf(r)>=0||(p[r]=t[r]);return p}(t,e);if(Object.getOwnPropertySymbols){var c=Object.getOwnPropertySymbols(t);for(n=0;n<c.length;n++)r=c[n],e.indexOf(r)>=0||Object.prototype.propertyIsEnumerable.call(t,r)&&(p[r]=t[r])}return p}var a=n.createContext({}),s=function(t){var e=n.useContext(a),r=e;return t&&(r="function"==typeof t?t(e):i(i({},e),t)),r},l=function(t){var e=s(t.components);return n.createElement(a.Provider,{value:e},t.children)},m="mdxType",u={inlineCode:"code",wrapper:function(t){var e=t.children;return n.createElement(n.Fragment,{},e)}},d=n.forwardRef((function(t,e){var r=t.components,p=t.mdxType,c=t.originalType,a=t.parentName,l=o(t,["components","mdxType","originalType","parentName"]),m=s(r),d=p,y=m["".concat(a,".").concat(d)]||m[d]||u[d]||c;return r?n.createElement(y,i(i({ref:e},l),{},{components:r})):n.createElement(y,i({ref:e},l))}));function y(t,e){var r=arguments,p=e&&e.mdxType;if("string"==typeof t||p){var c=r.length,i=new Array(c);i[0]=d;var o={};for(var a in e)hasOwnProperty.call(e,a)&&(o[a]=e[a]);o.originalType=t,o[m]="string"==typeof t?t:p,i[1]=o;for(var s=2;s<c;s++)i[s]=r[s];return n.createElement.apply(null,i)}return n.createElement.apply(null,r)}d.displayName="MDXCreateElement"},77641:(t,e,r)=>{r.r(e),r.d(e,{assets:()=>a,contentTitle:()=>i,default:()=>u,frontMatter:()=>c,metadata:()=>o,toc:()=>s});var n=r(87462),p=(r(67294),r(3905));const c={},i=void 0,o={unversionedId:"network/tcp_timestamps",id:"network/tcp_timestamps",title:"tcp_timestamps",description:'\u670d\u52a1\u7aef\u6293\u5305\u53d1\u73b0\u5ba2\u6237\u7aef\u53d1\u5305\u53ea\u6709 SYN\uff0c\u6ca1\u6709\u56de\u5305\uff0c\u53ef\u4ee5\u6267\u884cnetstat -s |grep rejec \u67e5\u770b\u4e0b\u662f\u5426\u662f tcptimestamps \u7684\u95ee\u9898\u3002\u5982\u679c\u51fa\u73b0\u6570\u636e\u5305\u7684 timestamp \u88ab\u62d2\u7edd\uff0c\u5219\u68c0\u67e5\u4e0b\u5185\u6838\u53c2\u6570 tcptwrecycle \u662f\u5426\u5f00\u542f\uff0c\u5982\u679c\u5f00\u542f\uff0c\u5c06\u5176\u5173\u95ed\u5373\u53efecho "0" > /proc/sys/net/ipv4/tcptw_recycle',source:"@site/docs/network/tcp_timestamps.md",sourceDirName:"network",slug:"/network/tcp_timestamps",permalink:"/docs/network/tcp_timestamps",draft:!1,editUrl:"https://github.com/yoloz/yolo-docs/tree/docusaurus/docs/network/tcp_timestamps.md",tags:[],version:"current",lastUpdatedAt:1689650905,formattedLastUpdatedAt:"2023\u5e747\u670818\u65e5",frontMatter:{},sidebar:"tutorialSidebar",previous:{title:"linux\u5185\u6838\u63a5\u6536\u7f51\u7edc\u5305",permalink:"/docs/network/linux\u5185\u6838\u63a5\u6536\u7f51\u7edc\u5305"},next:{title:"tcpdump",permalink:"/docs/network/tcpdump"}},a={},s=[{value:"net.ipv4.tcp_timestamps",id:"netipv4tcp_timestamps",level:2},{value:"net.ipv4.tcp_tw_recycle",id:"netipv4tcp_tw_recycle",level:2}],l={toc:s},m="wrapper";function u(t){let{components:e,...r}=t;return(0,p.kt)(m,(0,n.Z)({},l,r,{components:e,mdxType:"MDXLayout"}),(0,p.kt)("p",null,"\u670d\u52a1\u7aef\u6293\u5305\u53d1\u73b0\u5ba2\u6237\u7aef\u53d1\u5305\u53ea\u6709 SYN\uff0c\u6ca1\u6709\u56de\u5305\uff0c\u53ef\u4ee5\u6267\u884c",(0,p.kt)("inlineCode",{parentName:"p"},"netstat -s |grep rejec")," \u67e5\u770b\u4e0b\u662f\u5426\u662f tcp_timestamps \u7684\u95ee\u9898\u3002\u5982\u679c\u51fa\u73b0\u6570\u636e\u5305\u7684 timestamp \u88ab\u62d2\u7edd\uff0c\u5219\u68c0\u67e5\u4e0b\u5185\u6838\u53c2\u6570 tcp_tw_recycle \u662f\u5426\u5f00\u542f\uff0c\u5982\u679c\u5f00\u542f\uff0c\u5c06\u5176\u5173\u95ed\u5373\u53ef",(0,p.kt)("inlineCode",{parentName:"p"},'echo "0" > /proc/sys/net/ipv4/tcp_tw_recycle')),(0,p.kt)("h2",{id:"netipv4tcp_timestamps"},"net.ipv4.tcp_timestamps"),(0,p.kt)("p",null,"tcp_timestamps \u4f1a\u8bb0\u5f55\u6570\u636e\u5305\u7684\u53d1\u9001\u65f6\u95f4\u3002\u57fa\u672c\u7684\u6b65\u9aa4\u5982\u4e0b\uff1a\n\u53d1\u9001\u65b9\u5728\u53d1\u9001\u6570\u636e\u65f6\uff0c\u5c06\u4e00\u4e2a timestamp(\u8868\u793a\u53d1\u9001\u65f6\u95f4)\u653e\u5728\u5305\u91cc\u9762\n\u63a5\u6536\u65b9\u5728\u6536\u5230\u6570\u636e\u5305\u540e\uff0c\u5728\u5bf9\u5e94\u7684 ACK \u5305\u4e2d\u5c06\u6536\u5230\u7684 timestamp \u8fd4\u56de\u7ed9\u53d1\u9001\u65b9(echo back)\n\u53d1\u9001\u65b9\u6536\u5230 ACK \u5305\u540e\uff0c\u7528\u5f53\u524d\u65f6\u523b now - ACK \u5305\u4e2d\u7684 timestamp \u5c31\u80fd\u5f97\u5230\u51c6\u786e\u7684 RTT\ntimestamps \u4e00\u4e2a\u53cc\u5411\u7684\u9009\u9879\uff0c\u5f53\u4e00\u65b9\u4e0d\u5f00\u542f\u65f6\uff0c\u4e24\u65b9\u90fd\u5c06\u505c\u7528 timestamps\u3002\u6bd4\u5982 client \u7aef\u53d1\u9001\u7684 SYN \u5305\u4e2d\u5e26\u6709 timestamp \u9009\u9879\uff0c\u4f46 server \u7aef\u5e76\u6ca1\u6709\u5f00\u542f\u8be5\u9009\u9879\u3002\u5219\u56de\u590d\u7684 SYN-ACK \u5c06\u4e0d\u5e26 timestamp \u9009\u9879\uff0c\u540c\u65f6 client \u540e\u7eed\u56de\u590d\u7684 ACK \u4e5f\u4e0d\u4f1a\u5e26\u6709 timestamp \u9009\u9879\u3002\u5982\u679c client \u53d1\u9001\u7684 SYN \u5305\u4e2d\u5c31\u4e0d\u5e26 timestamp\uff0c\u53cc\u5411\u90fd\u5c06\u505c\u7528 timestamp\u3002"),(0,p.kt)("p",null,"tcp \u6570\u636e\u5305\u4e2d timestamps \u7684 value \u662f\u7cfb\u7edf\u5f00\u673a\u65f6\u95f4\u5230\u73b0\u5728\u65f6\u95f4\u7684\uff08\u6beb\u79d2\u7ea7\uff09\u65f6\u95f4\u6233\u3002"),(0,p.kt)("h2",{id:"netipv4tcp_tw_recycle"},"net.ipv4.tcp_tw_recycle"),(0,p.kt)("p",null,"TCP \u89c4\u8303\u4e2d\u89c4\u5b9a\u7684\u5904\u4e8e TIME_WAIT \u7684 TCP \u8fde\u63a5\u5fc5\u987b\u7b49\u5f85 2msl \u65f6\u95f4\u3002\u4f46\u5728 linux \u4e2d\uff0c\u5982\u679c\u5f00\u542f\u4e86 tcp_tw_recycle\uff0cTIME_WAIT \u7684 TCP \u8fde\u63a5\u5c31\u4e0d\u4f1a\u7b49\u5f85 2msl \u65f6\u95f4\uff08\u800c\u662f rto \u6216\u8005 60s\uff09\uff0c\u4ece\u800c\u8fbe\u5230\u5feb\u901f\u91cd\u7528\uff08\u56de\u6536\uff09\u5904\u4e8e TIME_WAIT \u72b6\u6001\u7684 tcp \u8fde\u63a5\u7684\u76ee\u7684\u3002\u8fd9\u5c31\u53ef\u80fd\u5bfc\u81f4\u8fde\u63a5\u6536\u5230\u4e4b\u524d\u8fde\u63a5\u7684\u6570\u636e\u3002\u4e3a\u6b64\uff0clinux \u5728\u6253\u5f00 tcp_tw_recycle \u7684\u60c5\u51b5\u4e0b\uff0c\u4f1a\u8bb0\u5f55\u4e0b TIME_WAIT \u8fde\u63a5\u7684\u5bf9\u7aef\uff08peer\uff09\u4fe1\u606f\uff0c\u5305\u62ec IP \u5730\u5740\u3001\u65f6\u95f4\u6233\u7b49\u3002\u8fd9\u6837\uff0c\u5f53\u5185\u6838\u6536\u5230\u540c\u4e00\u4e2a IP \u7684 SYN \u5305\u65f6\uff0c\u5c31\u4f1a\u53bb\u6bd4\u8f83\u65f6\u95f4\u6233\uff0c\u68c0\u67e5 SYN \u5305\u7684\u65f6\u95f4\u6233\u662f\u5426\u6ede\u540e\uff0c\u5982\u679c\u6ede\u540e\uff0c\u5c31\u5c06\u5176\u4e22\u6389\uff08\u8ba4\u4e3a\u662f\u65e7\u8fde\u63a5\u7684\u6570\u636e\uff09\u3002"),(0,p.kt)("p",null,"\u5982\u679c\u7528\u6237\u662f\u5728\u4e00\u4e2a NAT \u73af\u5883\u4e0b\uff0c\u6216\u8005\u51fa\u53e3 IP \u53ea\u6709\u4e00\u4e2a\uff0c\u540c\u65f6\u6709\u591a\u4e2a\u7528\u6237\u8bbf\u95ee\u540c\u4e00\u4e2a\u670d\u52a1\uff0c\u5c31\u6709\u53ef\u80fd\u56e0\u4e3a\u65f6\u95f4\u6233\u6ede\u540e\u7684\u8fde\u63a5\u88ab\u4e22\u6389\uff0c\u6839\u636e\u4e0a\u8ff0 SYN \u5305\u5904\u7406\u89c4\u5219\uff0c\u5728 tcp_tw_recycle \u548c tcp_timestamps \u540c\u65f6\u5f00\u542f\u7684\u6761\u4ef6\u4e0b\uff0ctimestamp \u5927\u7684\u4e3b\u673a\u8bbf\u95ee serverN \u6210\u529f\uff0c\u800c timestmap \u5c0f\u7684\u4e3b\u673a\u8bbf\u95ee\u5931\u8d25\u3002"))}u.isMDXComponent=!0}}]);